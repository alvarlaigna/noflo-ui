INPORT=Dispatch.IN:IN
OUTPORT=Dispatch.PASS:PASS
OUTPORT=NewActions.OUT:NEW

'github:open,github:gist,github:sync:prepare,github:sync:synchronize,github:sync:pull' -> ROUTES Dispatch(ui/DispatchAction)

# New actions generated by this middleware
'application:hash' -> ACTION ApplicationRedirectAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:save:graph' -> ACTION SaveGraphAction(ui/SetAction) OUT -> IN NewActions
'storage:save:component' -> ACTION SaveComponentAction(ui/SetAction) OUT -> IN NewActions
'storage:save:spec' -> ACTION SaveSpecAction(ui/SetAction) OUT -> IN NewActions
'storage:save:project' -> ACTION SaveProjectAction(ui/SetAction) OUT -> IN NewActions
'github:operation' -> ACTION GithubOperationAction(ui/SetAction) OUT -> IN NewActions
'github:error' -> ACTION ErrorAction(ui/SetAction) OUT -> IN NewActions

# Downloading a GitHub project
Dispatch HANDLE[0] -> IN ErrorAction

# Downloading a gist example
# First check if we already have a local version of the gist
Dispatch HANDLE[1] -> IN CheckGist(ui/CheckGistExists)
# If it already exists, redirect
CheckGist EXISTING -> IN ApplicationRedirectAction
# If not, download as new project
CheckGist NEW -> IN GetGist(ui/GistToProject)
GetGist GRAPH -> IN SaveGraphAction
GetGist COMPONENT -> IN SaveComponentAction
GetGist PROJECT -> IN SaveProjectAction
GetGist ERROR -> IN ErrorAction

# Preparing to synchronize with GitHub
Dispatch HANDLE[2] -> IN GetPrepareToken(ui/GetUserToken)
GetPrepareToken TOKEN -> TOKEN GithubSynchronization(ui/GithubSynchronization)
GetPrepareToken OUT -> PREPARE GithubSynchronization
GetPrepareToken ERROR -> IN ErrorAction
GithubSynchronization OPERATION -> IN GithubOperationAction
GithubSynchronization ERROR -> IN ErrorAction

# Two-way GitHub synchronization
Dispatch HANDLE[3] -> IN GetSyncToken(ui/GetUserToken)
GetSyncToken TOKEN -> TOKEN GithubSynchronization
GetSyncToken OUT -> SYNC GithubSynchronization
GetSyncToken ERROR -> IN ErrorAction
GithubSynchronization GRAPH -> IN SaveGraphAction
GithubSynchronization COMPONENT -> IN SaveComponentAction
GithubSynchronization SPEC -> IN SaveSpecAction

# Pulling a GitHub project
Dispatch HANDLE[4] -> IN GetPullToken(ui/GetUserToken)
GetPullToken TOKEN -> TOKEN GithubSynchronization
GetPullToken OUT -> PULL GithubSynchronization
GetPullToken ERROR -> IN ErrorAction
