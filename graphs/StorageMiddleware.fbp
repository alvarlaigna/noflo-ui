INPORT=Dispatch.IN:IN
OUTPORT=Dispatch.PASS:PASS
OUTPORT=NewActions.OUT:NEW

'noflo:ready,storage:load:*,storage:save:*' -> ROUTES Dispatch(ui/DispatchAction)

# New actions generated by this middleware
'storage:db' -> ACTION StorageDbAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:load:all' -> ACTION StorageInitialLoadAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:project' -> ACTION StorageProjectAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:graph' -> ACTION StorageGraphAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:component' -> ACTION StorageComponentAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:spec' -> ACTION StorageSpecAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:runtime' -> ACTION StorageRuntimeAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:error' -> ACTION StorageErrorAction(ui/SetAction) OUT -> IN NewActions(core/Merge)

# Prepare IndexedDB database
'noflo-ui' -> STRING DbName(strings/SendString)
Dispatch HANDLE[0] -> IN DbName OUT -> NAME PrepareStorage(ui/PrepareStorage)
PrepareStorage DB -> IN StorageDbAction
# When we have database, we want to trigger loading of local data
PrepareStorage DB -> IN StorageInitialLoadAction
PrepareStorage ERROR -> IN StorageErrorAction

# Loading data from the DB
Dispatch HANDLE[1] -> IN LoadData(ui/LoadData)
LoadData PROJECT -> IN StorageProjectAction
LoadData GRAPH -> IN StorageGraphAction
LoadData COMPONENT -> IN StorageComponentAction
LoadData SPEC -> IN StorageSpecAction
LoadData RUNTIME -> IN StorageRuntimeAction
LoadData ERROR -> IN StorageErrorAction

# Saving data to the DB
Dispatch HANDLE[2] -> IN SaveData(ui/SaveData)
SaveData PROJECT -> IN StorageProjectAction
SaveData GRAPH -> IN StorageGraphAction
SaveData COMPONENT -> IN StorageComponentAction
SaveData SPEC -> IN StorageSpecAction
SaveData RUNTIME -> IN StorageRuntimeAction
SaveData ERROR -> IN StorageErrorAction
